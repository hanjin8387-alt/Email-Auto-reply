# Backend / API Report â€” MailTriageAssistant
> Date: 2026-02-13
> Reviewer: Agent 03 (Backend/API)

## Summary
- ì´ ì´ìŠˆ: 14 | Critical: 3 | Major: 5 | Minor: 4 | Info: 2

## Service Architecture

```
App.xaml.cs (DI Root)
â”œâ”€â”€ MainWindow â† MainViewModel
â”‚   â”œâ”€â”€ IOutlookService (OutlookService â€” Singleton, IDisposable)
â”‚   â”‚   â””â”€â”€ COM STA Thread â†’ Outlook.Application
â”‚   â”œâ”€â”€ RedactionService (Singleton)
â”‚   â”œâ”€â”€ ClipboardSecurityHelper (Singleton, IDisposable)
â”‚   â”‚   â””â”€â”€ RedactionService
â”‚   â”œâ”€â”€ TriageService (Singleton)
â”‚   â”‚   â””â”€â”€ IOptions<TriageSettings>
â”‚   â”œâ”€â”€ DigestService (Singleton)
â”‚   â”‚   â”œâ”€â”€ ClipboardSecurityHelper
â”‚   â”‚   â””â”€â”€ RedactionService
â”‚   â”œâ”€â”€ TemplateService (Singleton)
â”‚   â””â”€â”€ IDialogService (WpfDialogService â€” Singleton)
```

---

## Findings

### ğŸ”´ Critical

| # | ì¹´í…Œê³ ë¦¬ | íŒŒì¼:í•¨ìˆ˜ | ì´ìŠˆ | CVSS | ê¶Œì¥ì‚¬í•­ |
|---|---|---|---|---|---|
| C-01 | CancellationToken | `IOutlookService` ì „ì²´ | ëª¨ë“  `Task`-ë°˜í™˜ ë©”ì„œë“œì— `CancellationToken` ë¯¸ì§€ì›. ì‚¬ìš©ìê°€ ì‘ì—… ì·¨ì†Œ ë¶ˆê°€, Outlook hang ì‹œ ì•± ì „ì²´ ëŒ€ê¸° | â€” | ëª¨ë“  ê³µê°œ ë¹„ë™ê¸° ë©”ì„œë“œì— `CancellationToken ct = default` íŒŒë¼ë¯¸í„° ì¶”ê°€ |
| C-02 | DI ìƒëª…ì£¼ê¸° | `App.xaml.cs:57-58` | `MainViewModel`ê³¼ `MainWindow`ê°€ **Singleton**. WPFì—ì„œ Windowë¥¼ Singletonìœ¼ë¡œ ë“±ë¡í•˜ë©´ ë‹«ê¸°/ì¬ì—´ê¸° ì‹œ `Cannot set Visibility` ì—ëŸ¬ | â€” | `MainWindow` â†’ Transient, `MainViewModel` â†’ Scoped ë˜ëŠ” Transient |
| C-03 | ì„¤ì • í•« ë¦¬ë¡œë“œ | `TriageService` ìƒì„±ì | `IOptions<TriageSettings>` ëŒ€ì‹  `TriageSettings` ì§ì ‘ ì£¼ì…(ê°’ ë³µì‚¬). VIP ëª©ë¡ ë³€ê²½ ì‹œ ì•± ì¬ì‹œì‘ í•„ìš” | â€” | `IOptionsMonitor<TriageSettings>` ì „í™˜ â†’ ëŸ°íƒ€ì„ ì„¤ì • ë³€ê²½ ê°ì§€ |

### ğŸŸ¡ Major

| # | ì¹´í…Œê³ ë¦¬ | íŒŒì¼:í•¨ìˆ˜ | ì´ìŠˆ | ê¶Œì¥ì‚¬í•­ |
|---|---|---|---|---|
| M-01 | ì¸í„°í˜ì´ìŠ¤ ë¶€ì¬ | `RedactionService`, `TriageService`, `DigestService`, `TemplateService` | 4ê°œ ì„œë¹„ìŠ¤ê°€ **ì¸í„°í˜ì´ìŠ¤ ì—†ì´ êµ¬ì²´ í´ë˜ìŠ¤ ì§ì ‘ ë“±ë¡**. Mock í…ŒìŠ¤íŠ¸ ì œí•œ, êµì²´ ì–´ë ¤ì›€ | ê° ì„œë¹„ìŠ¤ì— `IRedactionService`, `ITriageService`, `IDigestService`, `ITemplateService` ì¸í„°í˜ì´ìŠ¤ ì¶”ì¶œ |
| M-02 | ì—ëŸ¬ ëª¨ë¸ | `OutlookService` ì „ì²´ | `InvalidOperationException`, `NotSupportedException`, `TimeoutException` í˜¼ìš©. í˜¸ì¶œìê°€ ì˜ˆì™¸ íƒ€ì…ìœ¼ë¡œ ë¶„ê¸°í•´ì•¼ í•¨ | ì „ìš© ì˜ˆì™¸ ê³„ì¸µ ë„ì…: `OutlookException(string message, OutlookErrorKind kind)` |
| M-03 | appsettings ëŸ°íƒ€ì„ ì €ì¥ | `appsettings.json` | í˜„ì¬ ì½ê¸° ì „ìš©. VIP ê´€ë¦¬ UIì—ì„œ ìˆ˜ì • ì‹œ **ëŸ°íƒ€ì„ ì €ì¥ ë©”ì»¤ë‹ˆì¦˜ ë¶€ì¬** | `IWritableOptions<T>` íŒ¨í„´ ë˜ëŠ” ë³„ë„ JSON íŒŒì¼(`user_settings.json`) ë¶„ë¦¬ |
| M-04 | DigestService MessageBox | `DigestService.cs:104-108` | Teams ì—°ê²° ì‹¤íŒ¨ ì‹œ `MessageBox.Show()` ì§ì ‘ í˜¸ì¶œ â€” ViewModel ë°–ì—ì„œ UI ì˜ì¡´ | `IDialogService` ì£¼ì… â†’ `ShowInfo()` í˜¸ì¶œë¡œ ë³€ê²½ |
| M-05 | TemplateService Outlook ì˜ì¡´ | `TemplateService` ë¯¸ì‚¬ìš© | `TemplateService`ê°€ `IOutlookService.CreateDraft()`ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šê³ , ViewModelì´ ì¤‘ê³„. ì—­í•  ê²½ê³„ ëª¨í˜¸ | `TemplateService.SendDraft()` ë©”ì„œë“œë¥¼ ì •ì˜í•˜ê±°ë‚˜, ViewModel ì „ìš© í—¬í¼ë¡œ ëª…í™•í™” |

### ğŸŸ¢ Minor

| # | ì¹´í…Œê³ ë¦¬ | íŒŒì¼:í•¨ìˆ˜ | ì´ìŠˆ | ê¶Œì¥ì‚¬í•­ |
|---|---|---|---|---|
| m-01 | API ì´ë¦„ | `OutlookService.OpenItem` | `OpenItem`ì€ ì¼ë°˜ì . `DisplayMailInOutlook`ì´ ì˜ë„ ëª…í™• | ì´ë¦„ ë³€ê²½ ë˜ëŠ” XML doc ì¶”ê°€ |
| m-02 | ë°˜í™˜ íƒ€ì… | `TriageService.AnalyzeHeader/AnalyzeWithBody` | `TriageResult`ê°€ `readonly record struct`ë¼ Boxing ë¹„ìš© ì—†ìœ¼ë‚˜, `Tags`ê°€ `string[]` â†’ ë¶ˆë³€ ì»¬ë ‰ì…˜ ê¶Œì¥ | `IReadOnlyList<string>` ë°˜í™˜ ê²€í†  |
| m-03 | null ì…ë ¥ | `DigestService.GenerateDigest(null)` | null ì…ë ¥ ì‹œ `NullReferenceException` (Guard ì—†ìŒ) | `ArgumentNullException` guard ì¶”ê°€ |
| m-04 | ì„¤ì • Validation | `TriageSettings` | `BaseScore < 0`, `VipBonus > 100` ë“± ë¹„í•©ë¦¬ì  ê°’ ê²€ì¦ ì—†ìŒ | `IValidateOptions<T>` êµ¬í˜„ |

### âšª Info

| # | ì¹´í…Œê³ ë¦¬ | ì´ìŠˆ |
|---|---|---|
| I-01 | ê¸ì • | DI ì»¨í…Œì´ë„ˆ ë„ì… ì™„ë£Œ âœ… â€” `App.xaml.cs:ConfigureServices()` |
| I-02 | ê¸ì • | `IDialogService` ì¶”ìƒí™” ì™„ë£Œ âœ… â€” ViewModelì—ì„œ MessageBox ì§ì ‘ í˜¸ì¶œ ì œê±° |

---

## Feature Integration Points

| ì„œë¹„ìŠ¤ | í™•ì¥ ë°©ë²• | ì˜í–¥ë„ |
|---|---|---|
| `TriageService` | VIP ëŸ°íƒ€ì„ ë³€ê²½ â†’ `IOptionsMonitor` ì „í™˜ | Medium |
| `App.xaml.cs` | NotifyIcon DI ë“±ë¡ + ìë™ ë¶„ë¥˜ íƒ€ì´ë¨¸ ì„œë¹„ìŠ¤ | Low |
| `MainViewModel` | í†µê³„ í”„ë¡œí¼í‹° + íƒ€ì´ë¨¸ Command | Medium |
| ì‹ ê·œ `ISettingsService` | `appsettings.json` ëŸ°íƒ€ì„ Read/Write | High |
| ì‹ ê·œ `SettingsViewModel` | VIP CRUD, ì–¸ì–´ ì „í™˜, ìë™ ë¶„ë¥˜ ì„¤ì • | Medium |

---

## Codex Handoff â€” Task List

| # | íŒŒì¼ | ë³€ê²½ ìš”ì§€ | Breaking | í…ŒìŠ¤íŠ¸ ì»¤ë§¨ë“œ | ìˆ˜ìš© ê¸°ì¤€ | ìœ„í—˜ë„ |
|---|---|---|---|---|---|---|
| T-01 | `Services/I*.cs` (4íŒŒì¼ ì‹ ê·œ) | `IRedactionService`, `ITriageService`, `IDigestService`, `ITemplateService` ì¸í„°í˜ì´ìŠ¤ ì¶”ì¶œ | Yes | `dotnet build && dotnet test` | ë¹Œë“œ+í…ŒìŠ¤íŠ¸ í†µê³¼ | Medium |
| T-02 | `App.xaml.cs` | ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ DI ë“±ë¡ìœ¼ë¡œ ë³€ê²½ | No | `dotnet build && dotnet test` | ë¹Œë“œ+í…ŒìŠ¤íŠ¸ í†µê³¼ | Low |
| T-03 | `IOutlookService.cs`, `OutlookService.cs` | ëª¨ë“  ë©”ì„œë“œì— `CancellationToken` ì¶”ê°€ | Yes | `dotnet build && dotnet test` | ë¹Œë“œ+í…ŒìŠ¤íŠ¸ í†µê³¼ | High |
| T-04 | `App.xaml.cs:57-58` | `MainWindow` Transient, `MainViewModel` Transient ë³€ê²½ | No | `dotnet build` | ë¹Œë“œ ì„±ê³µ | Low |
| T-05 | `TriageService`, `App.xaml.cs` | `IOptions` â†’ `IOptionsMonitor` ì „í™˜ | No | `dotnet build && dotnet test` | ë¹Œë“œ+í…ŒìŠ¤íŠ¸ í†µê³¼ | Medium |
| T-06 | ì‹ ê·œ `Services/ISettingsService.cs`, `Services/JsonSettingsService.cs` | VIP ëª©ë¡ ëŸ°íƒ€ì„ ì €ì¥ ì„œë¹„ìŠ¤ | No | `dotnet build` | ë¹Œë“œ ì„±ê³µ | Medium |
| T-07 | `DigestService.cs:104-108` | `MessageBox.Show` â†’ `IDialogService.ShowInfo()` | No | `dotnet build` | ë¹Œë“œ ì„±ê³µ | Low |
| T-08 | `Models/TriageSettings.cs` | `IValidateOptions<TriageSettings>` êµ¬í˜„ | No | `dotnet test` | ê²€ì¦ í…ŒìŠ¤íŠ¸ í†µê³¼ | Low |
